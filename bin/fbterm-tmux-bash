#!/bin/sh
if [[ -z "$TMUX" ]]; then
    SESSION="$(whoami)-$(basename $(tty))";
    # Start tmux server if it isn't already running
    echo "Starting tmux server..."
    /usr/bin/tmux start-server
    echo "tmux server started."
    # Create the session if it doesn't exist
    echo "Checking for tty session..."
    if /usr/bin/tmux has-session -t "$SESSION" 2> /dev/null; then
        echo "tty session already present, spawn new window..."
        /usr/bin/fbterm -- /usr/bin/tmux new-session -t "$SESSION" \; new-window /bin/bash;
    else
        echo "Creating tty session..."
        /usr/bin/fbterm -- /bin/sh -c \
            "/usr/bin/tmux has-session -t $SESSION 2> /dev/null && \
                 /usr/bin/tmux new-session -t $SESSION \; new-window /bin/bash || \
                 /usr/bin/tmux new-session -s $SESSION /bin/bash"
    fi
fi
